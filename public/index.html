<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Uploader</title>
</head>
<body>
<h1>Video Uploader</h1>

<!-- Login form -->
<h2>Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button id="loginBtn">Login</button>

<p id="tokenDisplay"></p>

<!-- Upload form -->
<h2>Upload Video</h2>
<input type="file" id="videoFile">
<button id="uploadBtn">Upload</button>

<h2>Uploaded Videos</h2>
<ul id="videoList"></ul>

<script>
    let token = '';

    // Login
    document.getElementById('loginBtn').onclick = async () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        if (!res.ok) return alert('Login failed!');
        const data = await res.json();
        token = data.token;
        document.getElementById('tokenDisplay').textContent = `Token: ${token}`;
        loadVideos();
    };

    // Upload video
    document.getElementById('uploadBtn').onclick = async () => {
        const file = document.getElementById('videoFile').files[0];
        if (!file) return alert('Select a file!');

        const formData = new FormData();
        formData.append('video', file);

        const res = await fetch('/upload', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + token },
            body: formData
        });

        if (!res.ok) return alert('Upload failed!');
        const data = await res.json();
        alert(`Uploaded! ID: ${data.id}`);
        loadVideos();
    };

    // Load videos
    async function loadVideos() {
        const res = await fetch('/videos', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        if (!res.ok) return;
        const videos = await res.json();
        const list = document.getElementById('videoList');
        list.innerHTML = '';
        videos.forEach(v => {
            const li = document.createElement('li');
            li.textContent = `${v.id}: ${v.filename || v.originalName} (${v.status})`;
            list.appendChild(li);
        });
    }
</script>
</body>
</html>
